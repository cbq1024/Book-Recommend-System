# 推荐系统概述

> [!NOTE]
>
> 个性化推荐 （推荐系统）经历了多年的发展，已经成为互联网产品的标配，也是 AI 成功落地的分支之一，在电商 （淘宝、京东），咨询 （今日头条、微博）、音乐（网易云音乐、QQ 音乐）、短视频（抖音、快手）等热门应用中，推荐系统都是核心组件之一，推荐系统产生的背景主要有以下几点：
>
> - 信息过载 | 用户需求不明确
>   - 分类目录 （1990 年左右）：覆盖少量热门网站 如 Hao 123 、Yahoo
>   - 搜索殷勤 （2000 年左右）：透过搜索词明确需求 如 Google、Baidu
>   - 推荐系统 （2010 年左右）：不需要用户提供明确的需求，通过分析用户的历史行为给用户的兴趣进行建模，从而主动给用户推荐能够满足他们兴趣和需求的信息

## 一、推荐系统概念

### 1.2 什么是推荐系统

> [!NOTE]
>
> **没有明确需求** 的用户访问我们的服务，且服务的物品对用户构成了 **信息过载**，系统通过 **一定的规则对物品进行排序**，并将排在前面的物品展示给用户 （Top N），这样的系统就是推荐系统

### 1.3 推荐系统与搜索引擎的区别

|          | 搜索                                                   | 推荐     |
| -------- | ------------------------------------------------------ | -------- |
| 行为方式 | 主动                                                   | 被动     |
| 意图     | 明确                                                   | 模糊     |
| 个性化   | 弱                                                     | 强       |
| 流量分布 | 马太效应 （2 -- 8 定理即 20 % 的数据提供 80 % 的服务） | 长尾效应 |
| 目标     | 快速满足                                               | 持续服务 |
| 评估指标 | 简明                                                   | 复杂     |

### 1.4 推荐系统的作用

1. 高效连接用户和物品，发现长尾商品
2. 留住用户和内容生产者，实现商业目标

### 1.5 推荐系统的工作原理和应用场景

1. **社会化推荐：** 向朋友咨询，社会化推荐，让好友给自己推荐物品
2. **基于内容的推荐：** 打开搜索引擎，输入自己喜欢的演员的名字，然后查看返回结果中还有什么电影是自己没看过的
3. **基于流行度的推荐：** 票房排行榜
4. **基于系统过滤的推荐：** 找到和自己历史兴趣相似的用户，看看他们最近在看什么电影

> [!NOTE]
>
> 推荐系统的应用场景有：feed 流 （信息推送服务）

## 二、推荐算法架构

### 2.1 推荐算法流程

1. 召回阶段 （海选）
   - 召回决定了最终推荐结果的天花板
   - 常用算法：
     - 协同过滤 （基于用户、基于物品）
     - 基于内容 （根据用户行为总结出自己的偏好，根据偏好，通过文本挖掘技术找到内容上相似的商品）
     - 基于隐语义
2. 排序阶段
   - 召回决定了最终推荐结果的天花板，排序逼近这个极限，决定最终的推荐效果
   - RTR 预估 （点击率预估，使用 LR 算法）估计用户是否会点击某个商品，需要用户的点击数据
3. 策略调整 （定制化策略）

![image-20240518135713978](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181357038.png)

### 2.2 推荐算法整体架构

> - https://www.zhihu.com/tardis/zm/art/445000776?source_id=1005

![image-20240518144340684](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181443787.png)

![image-20240518135828537](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181358636.png)

![image-20240518135847373](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181358464.png)

### 2.3 架构说明

#### 业务架构说明

1. 系统定期将 业务数据库 和 日志系统 中的数据加载到 分布式文件系统 （HDFS）中然后进行召回阶段 （离线数据处理）
2. 召回阶段，根据不同的类型选取不同的模型进行召回，并将召回的内容 （画像召回、热门召回、协同过滤召回、其它召回）合并
   - 基于协同过滤的召回，包括 ALS 模型、评分矩阵、偏好评分等
   - 基于内容的召回，包括 兴趣特征、属性特征、画像特征
   - 基于点击率的召回，即排序模型 包括 LR 模型、GBDT 模型
3. 上述召回阶段期间，如果有实时的数据需要计算，包括 用户 | 物品画像、相似度矩阵的计算，计算的结果影响





#### 技术架构说明





## 三、推荐模型构建流程

推荐系统是一种信息过滤系统，它的目的是预测用户对物品的“评价”或“偏好”。推荐系统的整体架构通常包括以下几个关键组件：

1. **数据收集**：推荐系统需要收集用户数据和物品数据。用户数据可能包括用户的行为（如点击、购买、评分等）、用户的人口统计信息（如年龄、性别、职业等）等。物品数据可能包括物品的描述信息（如标题、类别、价格等）
2. **数据预处理**：收集到的数据往往需要进行清洗和预处理，以便于后续的分析和建模。这可能包括去除噪声、填补缺失值、数据规范化等
3. 数据评估：评估数据是否符合系统要求
4. **特征工程**：特征工程是将原始数据转换为能够被推荐算法有效利用的特征。这可能包括用户特征（如用户历史行为、用户画像等）和物品特征（如物品属性、物品内容等）
5. **推荐算法**：推荐算法是推荐系统的核心，它根据用户和物品的特征来预测用户的偏好。常见的推荐算法包括协同过滤（基于用户或基于物品）、内容推荐、基于知识的推荐、混合推荐等
6. **模型训练**：推荐算法通常需要通过机器学习模型来实现。模型训练就是使用历史数据来训练这些模型，以便它们能够学习到用户和物品之间的关系
7. **推荐生成**：训练好的模型会被用来生成推荐列表。这个过程通常包括将用户特征和物品特征输入到模型中，然后得到一个排序的物品列表
8. **评估与优化**：推荐系统需要不断地评估其推荐效果，并根据评估结果进行优化。评估指标可能包括准确率、召回率、覆盖率、多样性、新颖性等
9. **用户界面**：推荐结果需要通过用户界面展示给用户。用户界面设计应该直观易用，能够有效地展示推荐结果，并允许用户进行交互（如点击、购买、评分等）
10. **实时反馈**：推荐系统通常需要实时处理用户的反馈，如用户的点击、购买等行为，以便及时调整推荐策略
11. **冷启动处理**：对于新用户或新物品，推荐系统需要有相应的策略来处理冷启动问题，如使用热门推荐、随机推荐等

> [!IMPORTANT]
>
> 推荐模型的一般构建流程为：
>
> Data （数据） ---> Features （特征） ---> ML AIgorithm （机器学习算法） ---> Prediction Output （预测输出）

![image-20240518144030525](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181440609.png)

### 3.1 数据获取及处理

#### 3.1.1 数据的来源

1. 显性数据
   - rating 打分 （爬取 ）
   - comments 评价 | 评论 （爬取 ）
2. 隐性数据
   - order History 历史订单 （爬取 ）
   - cart ecents 购物车数据 （爬取 ）
   - page views 页面浏览 （爬取 ）
   - click thru 点击 
   - search log 搜索记录

| 显性数据              | 隐性数据               | 获取方式                     |
| --------------------- | ---------------------- | ---------------------------- |
| rating 打分           |                        | 🕸️ 爬取                       |
| comments 评价 \| 评论 |                        | 🕸️ 爬取                       |
|                       | order History 历史订单 | 🕸️ 爬取、公开数据集 🥸         |
|                       | cart ecents 购物车数据 | 🕸️ 爬取、公开数据集 🥸         |
|                       | page views 页面浏览    | 🔨 主动记录收集、公开数据集 🥸 |
|                       | click thru 点击        | 🔨 主动记录收集、公开数据集 🥸 |
|                       | search log 搜索记录    | 🔨 主动记录收集、公开数据集 🥸 |

### 3.2 评判数据是否达标

通过相关指标，查看数据是否达标

### 3.3 特征工程

- 协同过滤：user-item 评分矩阵
- 基于内容：分词 tf-idf、word2Vec

#### 3.1.1 从数据中筛选特征

> [!IMPORTANT]
>
> 从数据中筛选特征主要是指：
>
> 1. 一个给定的商品，可能被用有类似品味或需求的用户购买
> 2. 使用用户行为描述商品

![image-20240518141300208](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181413271.png)

#### 3.3.2 用数据表示特征

> [!IMPORTANT]
>
> 用数据表示特征主要是指：
>
> 1. 将所有用户行为合并在一起，行程一个 user-item 矩阵

![image-20240518141349120](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405181413200.png)

### 3.4 选择算法

- 协同过滤
  - kNN
  - 矩阵分解

### 3.5 训练模型



3.7 推荐生成



### 3.6 评估、优化



### 3.7 用户界面



### 3.8 实时反馈



### 3.9 冷启动处理



### 3.10 模型部署







